<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Reader</title>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <style>
        #preview {
            width: 100%;
            height: auto;
        }
        .container {
            margin: 20px;
        }
        .qr-data {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QRコードリーダー</h1>
        <button id="startScanButton">QRコードを読み取る</button>
        <video id="preview" style="display:none;"></video>
        <div id="qrDataContainer">
            <h2>QRコードデータ</h2>
            <div id="qrDataList"></div>
        </div>
    </div>

    <script>
        // QRコードリーダーの初期化
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
        scanner.addListener('scan', function (content) {
            console.log(content);
            var quantity = prompt("数を入力してください:", "1");
            if (quantity != null) {
                var date = new Date();
                var dateString = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();

                // QRコードデータを表示
                var qrDataList = document.getElementById("qrDataList");
                var div = document.createElement("div");
                div.className = "qr-data";
                div.innerHTML = `
                    <p>QRコード: ${content}</p>
                    <p>数量: ${quantity}</p>
                    <p>日付: ${dateString}</p>
                    <label><input type="checkbox" onchange="markCompleted(this)"> 進度訂正済み</label>
                `;
                qrDataList.appendChild(div);

                alert("QRコードが読み取られました: " + content);
            }
        });

        // カメラモードを開始
        document.getElementById("startScanButton").addEventListener("click", function() {
            document.getElementById("preview").style.display = "block";
            Instascan.Camera.getCameras().then(function (cameras) {
                if (cameras.length > 0) {
                    let selectedCamera = cameras[0];
                    // 外カメラを選択する
                    cameras.forEach(camera => {
                        if (camera.name.toLowerCase().includes('back')) {
                            selectedCamera = camera;
                        }
                    });
                    scanner.start(selectedCamera);
                } else {
                    console.error('カメラが見つかりません。');
                }
            }).catch(function (e) {
                console.error(e);
            });
        });

        // 進度訂正済みのマーク
        function markCompleted(checkbox) {
            if (checkbox.checked) {
                checkbox.parentElement.style.textDecoration = "line-through";
            } else {
                checkbox.parentElement.style.textDecoration = "none";
            }
        }
    </script>
</body>
</html>
